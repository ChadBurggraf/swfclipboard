(function(){var SWFClipboard,count=0,instances={};function addInstance(movieName,instance){if(!instances[movieName]){instances[movieName]=instance;count=count+1}}function cumulativeOffset(element){var t=0,l=0;do{t=t+(element.offsetTop||0);l=l+(element.offsetLeft||0);element=element.offsetParent}while(element);return{top:t,left:l}}function extend(dest,source){source=source||{};dest=dest||{};var prop;for(prop in source){if(source.hasOwnProperty(prop)&&typeof source[prop]!=="undefined"){dest[prop]=source[prop]}}return dest}function getNextMovieName(){return"SWFClipboard_"+count}function removeInstance(movieName){if(instances[movieName]){instances[movieName]=null;delete instances[movieName];count=count-1}}SWFClipboard=function(target,copyText,options){target=target||"";copyText=copyText||"";options=extend({css:"swfclipboard",flashUrl:"swfclipboard.swf",navigate:true,navigateUrl:null,navigateTarget:"_blank",onFlashReady:null,onTextCopied:null,waitForLoad:false},options);var obj={},element,movieElement,eventQueue=[],isFlashReady=false,callTryCount=0,movieName=getNextMovieName();function callFlash(callee,args){var js,i,n;if(element){if(!isFlashReady){if(callTryCount<10){callTryCount=callTryCount+1;setTimeout(function(){callFlash(callee,args)},10)}else{throw"Tried to call Flash 10 times, but the movie is still not ready. Aborting call."}}else{args=args||[];callTryCount=0;if(typeof obj.movie()[callee]==="function"){js="obj.movie()[callee](";for(i=0,n=args.length;i<n;i=i+1){if(i>0){js=js+","}js=js+"args["+i+"]"}return eval(js+")")}}}}function executeEvent(){if(eventQueue.length>0){var f=eventQueue.shift();if(typeof f==="function"){f()}}}function queueEvent(handler,args){args=args||[];if(typeof handler==="function"){eventQueue.push(function(){handler.apply(null,args)});setTimeout(function(){executeEvent()},0)}}function refreshSize(){if(element){if(isFlashReady&&target){var size={width:target.offsetWidth,height:target.offsetHeight},pSize={width:target.parentNode.offsetWidth,height:target.parentNode.offsetHeight},location=cumulativeOffset(target);if(size.width>pSize.width){size.width=pSize.width}if(size.height>pSize.height){size.height=pSize.height}element.style.width=size.width+"px";element.style.height=size.height+"px";element.style.left=location.left+"px";element.style.top=location.top+"px";callFlash("setButtonSize",[size.width,size.height])}else{element.style.width="1px";element.style.height="1px";element.style.top="0px";element.style.left="0px"}}}function setup(){if(!element){if(typeof target==="string"){target=document.getElementById(target)}element=document.createElement("div");document.body.appendChild(element);element.className=options.css;element.style.position="absolute";element.style.display="block";element.style.width="1px";element.style.height="1px";element.style.left="0px";element.style.top="0px";element.innerHTML=['<object id="',movieName,'" type="application/x-shockwave-flash" data ="',options.flashUrl,'" width="100%" height="100%">','<param name="wmode" value="transparent"/>','<param name="movie" value="',options.flashUrl,'"/>','<param name="quality" value="high"/>','<param name="menu" value="false"/>','<param name="allowscriptaccess" value="always"/>','<param name="flashvars" value="',"movieName=",encodeURIComponent(movieName),"&amp;copyText=",encodeURIComponent(copyText||""),"&amp;navigateUrl=",encodeURIComponent(options.navigateUrl||""),"&amp;navigateTarget=",encodeURIComponent(options.navigateTarget||"_blank"),"&amp;navigate=",(!!(options.navigate)).toString(),'"/>',"</object>"].join("")}}function onFlashReady(){isFlashReady=true;obj.setTarget(target);if(typeof options.onFlashReady==="function"){options.onFlashReady(obj)}}function onTextCopied(){if(typeof options.onTextCopied==="function"){options.onTextCopied(obj)}}extend(obj,{destroy:function(){removeInstance(movieName);if(movieElement){movieElement=null}if(element){element.parentNode.removeChild(element);element=null}isFlashReady=false},flashReady:function(){if(!window[movieName]){window[movieName]=this.movie()}queueEvent(onFlashReady)},movie:function(){if(element){if(!movieElement){movieElement=document.getElementById(movieName);if(!movieElement){throw'Could not get a reference to movie "'+movieName+'".'}}}return movieElement},setCopyText:function(newCopyText){copyText=newCopyText||"";callFlash("setCopyText",[copyText])},setNavigate:function(newNavigateUrl,newNavigateTarget,newNavigate){options.navigateUrl=newNavigateUrl||"";options.navigateTarget=newNavigateTarget||"";options.navigate=!!(newNavigate);callFlash("setNavigate",[options.navigateUrl,options.navigateTarget,options.navigate])},setTarget:function(newTarget,prevent){target=newTarget?(typeof newTarget==="string"?document.getElementById(newTarget):newTarget):null;if(target){if(!prevent&&!options.navigateUrl){if(options.navigate){options.navigateUrl=!target.href.match(/^javascript/i)?target.href:null;options.navigateTarget=target.target||"_blank"}else{options.navigateUrl=null}}callFlash("setNavigate",[options.navigateUrl,options.navigateTarget,!!(options.navigate)])}refreshSize()},textCopied:function(){queueEvent(onTextCopied)}});if(options.waitForLoad){if(window.addEventListener){window.addEventListener("load",setup)}else{window.attachEvent("onload",setup)}}else{setup()}addInstance(movieName,obj);return obj};window.SWFClipboard=SWFClipboard;window.SWFClipboard.instances=instances}());