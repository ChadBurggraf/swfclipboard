var SWFClipboard=Class.create({initialize:function(target,copyText,options){this.target=target;this.copyText=copyText||"";this.eventQueue=[];this.isFlashReady=false;this.movieName=SWFClipboard.getNextMovieName();this.options=Object.extend({css:"swfclipboard",flashUrl:"swfclipboard.swf",navigate:true,navigateUrl:null,navigateTarget:"_blank",onFlashReady:null,onTextCopied:null,waitForLoad:false},options);SWFClipboard.add(this.movieName,this);if(this.options.waitForLoad){document.observe("dom:loaded",this.setup.bind(this))}else{this.setup()}},callFlash:function(callee,args){if(this.element){if(!this.isFlashReady){setTimeout(this.callFlash.bind(this,callee,args),10)}else{args=args||[];if(typeof this.movie()[callee]==="function"){var str="this.movie()[callee](";for(var i=0,n=args.length;i<n;i++){if(i>0){str+=","}str+="args["+i+"]"}return eval(str+")")}else{throw'There is no Flash "'+callee+'" function defined.'}}}},destroy:function(){SWFClipboard.remove(this.movieName);if(this.movieElement){this.movieElement=null
}if(this.element){this.element.remove();this.element=null}this.isFlashReady=false},executeEvent:function(){if(this.eventQueue.length>0){var f=this.eventQueue.shift();if(typeof f==="function"){f()}}},movie:function(){if(this.element){if(!this.movieElement){this.movieElement=$(this.movieName);if(!this.movieElement){throw'Could not get a reference to movie "'+this.movieName+'".'}}}return this.movieElement},queueEvent:function(handler,args){args=args||[];if(typeof this[handler]==="function"){this.eventQueue.push(function(){this[handler].apply(this,args)}.bind(this));setTimeout(function(){this.executeEvent()}.bind(this),0)}else{throw'There is no "'+handler+'" event handler defined.'}},refreshSize:function(){if(this.element){if(this.isFlashReady&&this.target){var size=this.target.getDimensions();var pSize=this.target.up().getDimensions();var location=this.target.cumulativeOffset();if(size.width>pSize.width){size.width=pSize.width}if(size.height>pSize.height){size.height=pSize.height}this.element.setStyle({width:size.width+"px",height:size.height+"px",left:location.left+"px",top:location.top+"px"});
this.callFlash("setButtonSize",[size.width,size.height])}else{this.element.setStyle({width:"1px",height:"1px",top:"0px",left:"0px"})}}},setCopyText:function(copyText){this.copyText=copyText||"";this.callFlash("setCopyText",[this.copyText])},setNavigate:function(navigateUrl,navigateTarget,navigate){Object.extend(this.options,{navigateUrl:navigateUrl||"",navigateTarget:navigateTarget||"_blank",navigate:navigate===true});this.callFlash("setNavigate",[this.options.navigateUrl,this.options.navigateTarget,this.options.navigate])},setTarget:function(target,prevent){this.target=$(target);if(this.target){if(!prevent&&this.options.navigate&&this.target.tagName.toLowerCase()==="a"){this.options.navigateUrl=this.target.readAttribute("href");this.options.navigateTarget=this.target.readAttribute("target")||"_blank";this.callFlash("setNavigate",[this.options.navigateUrl,this.options.navigateTarget,this.options.navigate===true])}}this.refreshSize()},setup:function(){this.target=$(this.target);this.options.navigate=this.options.navigate===true;
this.element=new Element("span",{"class":this.options.css,style:"position:absolute;display:block;width:1px;height:1px;"});document.body.appendChild(this.element);this.element.update(['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.options.flashUrl,'" width="100%" height="100%">','<param name="wmode" value="transparent" />','<param name="movie" value="',this.options.flashUrl,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowscriptaccess" value="always" />','<param name="flashvars" value="',"movieName=",encodeURIComponent(this.movieName),"&amp;copyText=",encodeURIComponent(this.copyText||""),"&amp;navigateUrl=",encodeURIComponent(this.options.navigateUrl||""),"&amp;navigateTarget=",encodeURIComponent(this.options.navigateTarget||"_blank"),"&amp;navigate=",this.options.navigate.toString(),'" />',"</object>"].join(""))},flashReady:function(){if(!window[this.movieName]){window[this.movieName]=this.movie()
}this.queueEvent("onFlashReady")},textCopied:function(){this.queueEvent("onTextCopied")},onFlashReady:function(){this.isFlashReady=true;this.refreshSize();if(Object.isFunction(this.options.onFlashReady)){this.options.onFlashReady(this)}},onTextCopied:function(){if(Object.isFunction(this.options.onTextCopied)){this.options.onTextCopied(this)}}});Object.extend(SWFClipboard,{count:0,instances:{},add:function(movieName,instance){if(!SWFClipboard.instances[movieName]){SWFClipboard.instances[movieName]=instance;SWFClipboard.count++}},getNextMovieName:function(){return"SWFClipboard_"+SWFClipboard.count},remove:function(movieName){if(SWFClipboard.instances[movieName]){SWFClipboard.instances[movieName]=null;delete SWFClipboard.instances[movieName];--SWFClipboard.count}}});