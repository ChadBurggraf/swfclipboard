var SWFClipboard=function(target,copyText,options){this.target=target;this.copyText=copyText||"";this.eventQueue=[];this.isFlashReady=false;this.movieName=SWFClipboard.getNextMovieName();this.options={css:"swfclipboard",flashUrl:"swfclipboard.swf",navigate:true,navigateUrl:null,navigateTarget:"_blank",onFlashReady:null,onTextCopied:null,waitForLoad:false};for(var prop in options){if(options.hasOwnProperty(prop)){this.options[prop]=options[prop]}}SWFClipboard.add(this.movieName,this);if(this.options.waitForLoad){var that=this,f=function(){that.setup()};if(window.addEventListener){window.addEventListener("load",f)}else{window.attachEvent("onload",f)}}else{this.setup()}};SWFClipboard.prototype={callFlash:function(callee,args){if(this.element){if(!this.isFlashReady){var that=this;setTimeout(function(){that.callFlash(callee,args)},10)}else{args=args||[];if(typeof this.movie()[callee]==="function"){var js="this.movie()[callee](";for(var i=0,n=args.length;i<n;i++){if(i>0){js+=","}js+="args["+i+"]"}return eval(js+")")}else{throw'There is no Flash "'+callee+'" function defined.'}}}},destroy:function(){SWFClipboard.remove(this.movieName);if(this.movieElement){this.movieElement=null}if(this.element){this.element.remove();this.element=null}this.isFlashReady=false},executeEvent:function(){if(this.eventQueue.length>0){var f=this.eventQueue.shift();if(typeof f==="function"){f()}}},movie:function(){if(this.element){if(!this.movieElement){this.movieElement=document.getElementById(this.movieName);if(!this.movieElement){throw'Could not get a reference to movie "'+this.movieName+'".'}}}return this.movieElement},queueEvent:function(handler,args){args=args||[];if(typeof this[handler]==="function"){var that=this;this.eventQueue.push(function(){that[handler].apply(that,args)});setTimeout(function(){that.executeEvent()},0)}else{throw'There is no "'+handler+'" event handler defined.'}},refreshSize:function(){function co(element){var t=0,l=0;do{t+=element.offsetTop||0;l+=element.offsetLeft||0;element=element.offsetParent}while(element);return{top:t,left:l}}if(this.element){if(this.isFlashReady&&this.target){var size={width:this.target.offsetWidth,height:this.target.offsetHeight};var pSize={width:this.target.parentNode.offsetWidth,height:this.target.parentNode.offsetHeight};var location=co(this.target);if(size.width>pSize.width){size.width=pSize.width}if(size.height>pSize.height){size.height=pSize.height}this.element.style.width=size.width+"px";this.element.style.height=size.height+"px";this.element.style.left=location.left+"px";this.element.style.top=location.top+"px";this.callFlash("setButtonSize",[size.width,size.height])}else{this.element.style.width="1px";this.element.style.height="1px";this.element.style.top="0px";this.element.style.left="0px"}}},setCopyText:function(copyText){this.copyText=copyText||"";this.callFlash("setCopyText",[this.copyText])},setNavigate:function(navigateUrl,navigateTarget,navigate){this.options.navigateUrl=navigateUrl||"";this.options.navigateTarget=navigateTarget||"";this.options.navigate=navigate===true;this.callFlash("setNavigate",[this.options.navigateUrl,this.options.navigateTarget,this.options.navigate])},setTarget:function(target,prevent){this.target=target?(typeof target==="string"?document.getElementById(target):target):null;if(this.target){if(!prevent&&this.options.navigate&&this.target.tagName.toLowerCase()==="a"&&!this.target.href.match(/^javascript/i)){this.options.navigateUrl=this.target.href||"";this.options.navigateTarget=this.target.target||"_blank";this.callFlash("setNavigate",[this.options.navigateUrl,this.options.navigateTarget,this.options.navigate===true])}}this.refreshSize()},setup:function(){if(this.target&&typeof this.target==="string"){this.target=document.getElementById(this.target)}this.options.navigate=this.options.navigate===true;this.element=document.createElement("div");document.body.appendChild(this.element);this.element.className=this.options.css;this.element.style.position="absolute";this.element.style.display="block";this.element.style.width="1px";this.element.style.height="1px";this.element.style.left="0px";this.element.style.top="0px";this.element.innerHTML=['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.options.flashUrl,'" width="100%" height="100%">','<param name="wmode" value="transparent" />','<param name="movie" value="',this.options.flashUrl,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowscriptaccess" value="always" />','<param name="flashvars" value="',"movieName=",encodeURIComponent(this.movieName),"&amp;copyText=",encodeURIComponent(this.copyText||""),"&amp;navigateUrl=",encodeURIComponent(this.options.navigateUrl||""),"&amp;navigateTarget=",encodeURIComponent(this.options.navigateTarget||"_blank"),"&amp;navigate=",this.options.navigate.toString(),'" />',"</object>"].join("")},flashReady:function(){if(!window[this.movieName]){window[this.movieName]=this.movie()}this.queueEvent("onFlashReady")},textCopied:function(){this.queueEvent("onTextCopied")},onFlashReady:function(){this.isFlashReady=true;this.setTarget(this.target);if(typeof this.options.onFlashReady==="function"){this.options.onFlashReady(this)}},onTextCopied:function(){if(typeof this.options.onTextCopied==="function"){this.options.onTextCopied(this)}}};SWFClipboard.count=0;SWFClipboard.instances={};SWFClipboard.add=function(movieName,instance){if(!SWFClipboard.instances[movieName]){SWFClipboard.instances[movieName]=instance;SWFClipboard.count++}};SWFClipboard.getNextMovieName=function(){return"SWFClipboard_"+SWFClipboard.count};SWFClipboard.remove=function(movieName){if(SWFClipboard.instances[movieName]){SWFClipboard.instances[movieName]=null;delete SWFClipboard.instances[movieName];--SWFClipboard.count}};